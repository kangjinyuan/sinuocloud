<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>思诺科技消安一体化平台</title>
		<meta name="keywords" content="">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Expires" content="0">
		<link rel="shortcut icon" href="img/common/logo.png" type="image/x-icon" />
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="video/video.js/dist/video-js.min.css">
		<link rel="stylesheet" href="css/swiper.min.css">
		<link rel="stylesheet" href="css/common.css?v=46f3e3365b" />
		<link rel="stylesheet" href="css/index.css?v=07840b2aa8" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="layui/layui.all.js"></script>
		<script src="js/suitWeb.js"></script>
		<script src="js/swiper.min.js"></script>
		<script src="js/echarts/echarts.min.js"></script>
		<script src="js/circle-progress.min.js"></script>
		<script src="js/wave-progress.js"></script>
		<script src="js/zoom-marker.min.js"></script>
		<script src="js/jquery.mousewheel.min.js"></script>
		<script src="js/hammer.min.js"></script>
		<script src="video/video.min.js"></script>
		<script src="video/videojs-flash.min.js"></script>
		<script src="js/vue.min.js"></script>
		<script src="js/requestUrl.js?v=fb870f73e4"></script>
		<script src="js/common.js?v=30133f77f6"></script>
	</head>

	<body>
		<div class="kjy-box v-dom" v-cloak>
			<div class="column-list-box column-list-width-25">
				<div class="row-list-box">
					<div class="row-list-inner-box">
						<div class="row-list-title-box">
							<div class="row-list-title-text">
								今日报警
							</div>
						</div>
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-269">
								<div class="today-alert-box">
									<div class="today-alert-title">报警总数:<span>{{todayAlarm.totalCount}}</span>起</div>
									<ul class="today-alert-content-box">
										<li>
											<div class="text-box">
												<p><span>{{todayAlarm.fireAlarmCount}}</span>起</p>
												<p>火警数量</p>
											</div>
										</li>
										<li>
											<div class="text-box position-transform-level">
												<p><span>{{todayAlarm.faultCount}}</span>起</p>
												<p>故障数量</p>
											</div>
										</li>
										<li>
											<div class="text-box">
												<p><span>{{todayAlarm.resetCount}}</span>起</p>
												<p>复位次数</p>
											</div>
										</li>
									</ul>
									<div class="cut-line cut-line-bg"></div>
									<ul class="today-alert-content-box">
										<li>
											<div class="text-box">
												<p><span class="grade-text-color0">{{todayAlarm.firstClassCount}}</span>起</p>
												<p>Ⅰ级预警</p>
											</div>
										</li>
										<li>
											<div class="text-box position-transform-level">
												<p><span class="grade-text-color1">{{todayAlarm.secondClassCount}}</span>起</p>
												<p>Ⅱ级预警</p>
											</div>
										</li>
										<li>
											<div class="text-box">
												<p><span class="grade-text-color2">{{todayAlarm.thirdClassCount}}</span>起</p>
												<p>Ⅲ级预警</p>
											</div>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row-list-box row-list-height-35">
					<div class="row-list-inner-box">
						<div class="row-list-title-box">
							<div class="row-list-title-text">
								实时报警
							</div>
						</div>
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-277">
								<div class="scroll-box alarm-record-box">
									<ul class="scroll-title-box">
										<li>报警等级</li>
										<li>报警位置</li>
										<li>报警类型</li>
										<li>报警时间</li>
									</ul>
									<div class="scroll-content-box">
										<div class="full-box" v-if="alarmRecord.length == 0">
											<div class="no-data-box">
												<div class="no-data-row-text">暂时没有实时报警哦</div>
											</div>
										</div>
										<div class="scroll-content-inner-box" v-else>
											<ul v-for="t in alarmRecord" v-on:click="alarmInfo(t);">
												<li v-bind:class="t.alarmLevel?t.alarmLevelClass:''">{{t.alarmLevel?t.alarmLevelText:'无'}}</li>
												<li v-bind:title="t.alarmLocation?t.alarmLocation:'无'">{{t.alarmLocation?t.alarmLocation:'无'}}</li>
												<li>{{t.alarmTypeText}}</li>
												<li v-bind:title="t.createTime">{{t.createTime}}</li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row-list-box row-list-height-30">
					<div class="row-list-inner-box">
						<div class="row-list-title-box">
							<div class="row-list-title-text">
								巡查任务
							</div>
						</div>
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-168">
								<div class="check-task-box">
									<div class="check-task-pie-box">
										<div class="check-task-pie"></div>
										<div class="text-box position-transform-vertical">
											<p>{{checkTask.completeRate}}%</p>
											<p>完成率</p>
										</div>
									</div>
									<div class="check-task-bar-box"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="column-list-box column-list-width-50">
				<div class="row-list-box margin-top-16">
					<div class="row-list-inner-box">
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-664">
								<div class="floor-img-box position-center">
									<img id="floorImage" name="floorImage" draggable="false" />
								</div>
								<div class="floor-box">
									<div class="icon icon-arrow-up" onclick="clickRolling('floorBox',0);"></div>
									<div class="floor-list-box" id="floorBox">
										<ul class="floor-list-inner-box">
											<li v-for="t in regionList" v-bind:class="t.isActive?'selected':''" v-on:click="tabRegion(t);">{{t.name}}</li>
										</ul>
									</div>
									<div class="icon icon-arrow-down" onclick="clickRolling('floorBox',1);"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="column-list-box column-list-width-25">
					<div class="row-list-box">
						<div class="row-list-inner-box">
							<div class="row-list-title-box row-list-small-title">
								<div class="row-list-title-text">
									消防供水
								</div>
							</div>
							<div class="row-list-content-box">
								<div class="decorate-list decorate-left-top position-left-top"></div>
								<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
								<div class="decorate-list decorate-right-top position-right-top"></div>
								<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
								<div class="row-list-content-inner-box row-list-height-168">
									<div class="fire-water-box">
										<div class="swiper-container fire-water-swiper">
											<ul class="swiper-wrapper">
												<li class="swiper-slide" v-for="t in fireWater">
													<div class="fire-water-title">{{t.levelName}}</div>
													<div class="fire-water-wave-box">
														<canvas class="fire-water-wave"></canvas>
													</div>
													<div class="fire-water-dir">参考值：{{t.referMinValue}}~{{t.referMaxValue}}m</div>
												</li>
											</ul>
											<div class="swiper-pagination"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="column-list-box column-list-width-25">
					<div class="row-list-box">
						<div class="row-list-inner-box">
							<div class="row-list-title-box row-list-small-title">
								<div class="row-list-title-text">
									电气火灾
								</div>
							</div>
							<div class="row-list-content-box">
								<div class="decorate-list decorate-left-top position-left-top"></div>
								<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
								<div class="decorate-list decorate-right-top position-right-top"></div>
								<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
								<div class="row-list-content-inner-box row-list-height-168">
									<div class="electric-fire-box">
										<div class="swiper-container electric-fire-swiper">
											<ul class="swiper-wrapper">
												<li class="swiper-slide" v-for="t in electricFire">
													<div class="electric-fire-list-box">
														<div class="electric-fire-list">
															<div class="icon icon-temperature"></div>
															<div class="text-box">
																<p>{{t.cableTemperature}}℃</p>
																<p>线缆温度</p>
															</div>
														</div>
														<div class="electric-fire-list">
															<div class="icon icon-Surplus-electrical"></div>
															<div class="text-box">
																<p>{{t.laveCurrent}}ma</p>
																<p>剩余电流</p>
															</div>
														</div>
													</div>
													<div class="electric-fire-list-box">
														<div class="electric-fire-list">
															<div class="icon icon-Voltage"></div>
															<div class="text-box">
																<p>{{t.voltage}}V</p>
																<p>电压</p>
															</div>
														</div>
														<div class="electric-fire-list">
															<div class="icon icon-electrical"></div>
															<div class="text-box">
																<p>{{t.current}}A</p>
																<p>电流</p>
															</div>
														</div>
													</div>
												</li>
											</ul>
											<div class="swiper-pagination"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="column-list-box column-list-width-50">
					<div class="row-list-box">
						<div class="row-list-inner-box">
							<div class="row-list-title-box">
								<div class="row-list-title-text">
									月度汇总
								</div>
							</div>
							<div class="row-list-content-box">
								<div class="decorate-list decorate-left-top position-left-top"></div>
								<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
								<div class="decorate-list decorate-right-top position-right-top"></div>
								<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
								<div class="row-list-content-inner-box row-list-height-168">
									<div class="month-summary-box">
										<div class="row-list-search-box">
											<select name="" id="monthSummary" onchange="getMonthSummary();">
												<option value="1">1月</option>
												<option value="2">2月</option>
												<option value="3">3月</option>
												<option value="4">4月</option>
												<option value="5">5月</option>
												<option value="6">6月</option>
												<option value="7">7月</option>
												<option value="8">8月</option>
												<option value="9">9月</option>
												<option value="10">10月</option>
												<option value="11">11月</option>
												<option value="12">12月</option>
											</select>
										</div>
										<ul class="month-summary-inner-box">
											<li>
												<div class="month-summary-title-box month-summary-alarm">
													<div class="month-summary-title-text position-transform-vertical">报警次数</div>
												</div>
												<div class="month-summary-number"><span>{{monthSummary.alarmCount?monthSummary.alarmCount:'0'}}</span>次</div>
											</li>
											<li>
												<div class="month-summary-title-box month-summary-fault">
													<div class="month-summary-title-text position-transform-vertical">故障次数</div>
												</div>
												<div class="month-summary-number"><span>{{monthSummary.faultCount?monthSummary.faultCount:'0'}}</span>次</div>
											</li>
											<li>
												<div class="month-summary-title-box month-summary-low-pressure">
													<div class="month-summary-title-text position-transform-vertical">低压报警</div>
												</div>
												<div class="month-summary-number"><span>{{monthSummary.lowPressureCount?monthSummary.lowPressureCount:'0'}}</span>次</div>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="column-list-box column-list-width-25">
				<div class="row-list-box">
					<div class="row-list-inner-box">
						<div class="row-list-title-box">
							<div class="row-list-title-text">
								安全指数
							</div>
						</div>
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-269">
								<div class="security-index-box">
									<div class="security-index-rank-box">
										<div class="security-index-ranking-inner-box position-transform-vertical">
											<div class="security-index-rank-title-box">
												<div class="security-index-rank-title-line position-left"></div>
												<div class="security-index-rank-shield"></div>
												<div class="security-index-rank-title-line position-right"></div>
											</div>
											<div class="security-index-rank-content">
												<p>第<span>{{safetyLevel.rankingNum}}</span>名</p>
												<p>郑州市内排名</p>
											</div>
										</div>
									</div>
									<div class="security-index-pie-box">
										<div class="security-index-pie-inner-box position-bottom">
											<div class="security-index-pie-bg-box position-center"></div>
											<div class="security-index-pie"></div>
											<div class="text-box position-transform-vertical">
												<p>今日得分</p>
												<p>{{safetyLevel.scoreNum}}</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row-list-box">
					<div class="row-list-inner-box">
						<div class="row-list-title-box">
							<div class="row-list-title-text">
								重点压力
							</div>
						</div>
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-277">
								<div class="key-stress-box">
									<div class="swiper-container key-stress-swiper">
										<ul class="swiper-wrapper">
											<li class="swiper-slide" v-for="t in keyStress">
												<div class="key-stress-name">{{t.floorAddress}}</div>
												<div class="key-stress-dir">参考值：{{t.lowestValue}}~{{t.highestValue}}Mpa</div>
												<div class="key-stress-gauge-box"></div>
											</li>
										</ul>
										<div class="swiper-pagination"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row-list-box">
					<div class="row-list-inner-box">
						<div class="row-list-title-box">
							<div class="row-list-title-text">
								待办工单
							</div>
						</div>
						<div class="row-list-content-box">
							<div class="decorate-list decorate-left-top position-left-top"></div>
							<div class="decorate-list decorate-left-bottom position-left-bottom"></div>
							<div class="decorate-list decorate-right-top position-right-top"></div>
							<div class="decorate-list decorate-right-bottom position-right-bottom"></div>
							<div class="row-list-content-inner-box row-list-height-168">
								<div class="scroll-box work-order-box">
									<ul class="scroll-title-box">
										<li>工单详情</li>
										<li>负责人</li>
										<li>计划结束时间</li>
									</ul>
									<div class="scroll-content-box" id="workOrder">
										<div class="full-box" v-if="workOrderList.length == 0">
											<div class="no-data-box">
												<div class="no-data-row-text">暂时没有待办工单哦</div>
											</div>
										</div>
										<div class="scroll-content-inner-box" v-else>
											<ul v-for="t in workOrderList">
												<li v-bind:title="t.orderDetail">{{t.orderDetail}}</li>
												<li>{{t.charger?t.charger:'无'}}</li>
												<li v-bind:title="t.scheduleEndTime">{{t.scheduleEndTime}}</li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script>
		param.todayAlarm = {};
		param.alarmRecord = [];
		param.checkTask = {};
		param.buildIndex = 1;
		param.regionList = [];
		param.workOrderList = [];
		param.monthSummary = {};
		param.fireWater = [];
		param.electricFire = [];
		param.safetyLevel = {};
		param.keyStress = [];
		loadVue(".v-dom", param);
		var date = new Date();
		var year = date.getFullYear();
		var month = date.getMonth() + 1;
		$("#monthSummary").val(month);
		var checkTaskBar = echarts.init($(".check-task-bar-box").get(0));

		//今日报警
		function getTodayAlarm() {
			var param = {};
			request("POST", "/home/v1/alarmTodayNum", param, true, function(res) {
				setData.todayAlarm = res.data;
			}, function(res) {
				top.layer.msg("今日报警获取失败");
			});
		}

		//报警记录
		function setDeviceType(showLoading) {
			getDeviceType(function(res) {
				setData.alarmRecord = [];
				for(var i = 0; i < res.length; i++) {
					if(res[i].id == "5" || res[i].id == "6") {
						res.splice(i--, 1);
						continue;
					}
					getAlarmRecord(showLoading, res[i]);
				}
			});
		}

		function getAlarmRecord(showLoading, deviceType) {
			var deviceTypeId = deviceType.id;
			var requestUrl = deviceType.alarmRequestUrl;
			var param = {
				pageNo: pageNo,
				pageSize: 10
			}
			if(deviceType.id == "3") {
				param.deviceType = "1";
			} else if(deviceType.id == "4") {
				param.deviceType = "2";
			}
			var alarmTypeList = deviceType.alarmType;
			request("POST", requestUrl, param, showLoading, function(res) {
				var dataList = res.data.dataList;
				for(var i = 0; i < dataList.length; i++) {
					for(var j = 0; j < alarmTypeList.length; j++) {
						if(dataList[i].alarmType == alarmTypeList[j].id) {
							dataList[i].alarmTypeText = alarmTypeList[j].name;
						}
					}
					if(deviceTypeId == "1") {
						if(dataList[i].alarmLevel == "1") {
							dataList[i].alarmLevelText = "Ⅰ级";
							dataList[i].alarmLevelClass = "grade-text-color0";
						} else if(dataList[i].alarmLevel == "2") {
							dataList[i].alarmLevelText = "Ⅱ级";
							dataList[i].alarmLevelClass = "grade-text-color1";
						} else if(dataList[i].alarmLevel == "3") {
							dataList[i].alarmLevelText = "Ⅲ级";
							dataList[i].alarmLevelClass = "grade-text-color2";
						}
					}
					setData.alarmRecord.push(dataList[i]);
				}
			}, function(res) {
				top.layer.msg("实时报警加载失败");
			});
		}

		//报警详情
		function alarmInfo(obj) {
			openMask("/parts/alarmInfo", [suitRem(6.88), suitRem(5.44)], function(layerDom, layerIframe) {
				layerIframe.setData.parentData = obj;
				if(obj.catchImageList.length > 1) {
					layerIframe.setSwiper();
				}
			});
		}

		//巡查任务
		function getCheckTask() {
			var param = {};
			request("POST", "/home/v1/checkTaskToday", param, true, function(res) {
				var dataInfo = res.data;
				checkTaskBar.setOption({
					tooltip: {
						show: false
					},
					grid: {
						left: "0",
						right: "0",
						bottom: "10",
						top: "20"
					},
					xAxis: [{
						type: 'value',
						show: false
					}],
					yAxis: [{
						type: 'category',
						show: false,
						data: ["今日完成情况", "今日巡检任务总数"]
					}],
					series: [{
						type: 'bar',
						barWidth: suitRem(0.08),
						label: {
							normal: {
								show: true,
								distance: suitRem(0),
								offset: [0, suitRem(-0.12)],
								position: "insideBottomLeft",
								formatter: function(res) {
									var name = res.name;
									var amount = res.data;
									return "{p|" + name + "}" + "{amount| " + amount + "个任务}";
								},
								textStyle: {
									rich: {
										amount: {
											padding: [0, 0, 0, suitRem(0.12)],
											fontSize: suitRem(0.14),
											color: "#1E95FF"
										},
										p: {
											fontSize: suitRem(0.14),
											color: "#fff"
										}
									}
								}
							},
						},
						itemStyle: {
							normal: {
								color: {
									type: 'linear',
									x: 0,
									y: 0,
									x2: 0,
									y2: 1,
									colorStops: [{
										offset: 0,
										color: '#07a6ff'
									}, {
										offset: 1,
										color: '#33d9fb'
									}]
								}
							}
						},
						data: [dataInfo.taskCompleteNum, dataInfo.checkTaskTotal]
					}]
				}, true);
				setCircleProgress($(".check-task-pie"), dataInfo.completeRate, suitRem(0.08), ["#2aa1e4", "#35c6ef"]);
				setData.checkTask = dataInfo;
			}, function(res) {
				top.layer.msg("今日巡查任务获取失败");
			});
		}

		//加载楼层
		function loadFloorImage() {
			$("#floorImage").zoomMarker({
				src: "img/floorImage/1-1.png",
				rate: 0.1,
				width: suitRem(5),
				min: suitRem(1),
				max: suitRem(10),
				marker_size: suitRem(0.48),
				zoom_lock: true,
				markers: []
			});
		}

		//加载区域
		function loadRegion() {
			var timestamp = new Date().getTime();
			getJson("/json/floor", function(res) {
				var buildIndex = setData.buildIndex;
				for(var i = 0; i < res.length; i++) {
					res[i].isActive = false;
					res[i].videoList = [];
				}
				loadDeviceVideo(res);
			});
		}

		//加载视频设备
		function loadDeviceVideo(regionList) {
			var param = {
				pageNo: pageNo,
				pageSize: 1000,
			}
			request("POST", "/device/v1/findNetworkVideoList", param, true, function(res) {
				var dataList = res.data.dataList;
				for(var i = 0; i < regionList.length; i++) {
					for(var j = 0; j < dataList.length; j++) {
						if(j < 10) {
							dataList[j].regionCode = "1-1";
						} else if(j >= 10 && j < 20) {
							dataList[j].regionCode = "1-2";
						} else {
							dataList[j].regionCode = "1-3";
						}
						if(regionList[i].id == dataList[j].regionCode) {
							regionList[i].videoList.push(dataList[j]);
						}
					}
				}
				setData.regionList = regionList;
				tabRegion(regionList[0]);
			}, function(res) {
				top.layer.msg("视频设备加载失败");
			});
		}

		//切换区域
		function tabRegion(obj) {
			resetVideo();
			var regionList = setData.regionList;
			for(var i = 0; i < regionList.length; i++) {
				regionList[i].isActive = false;
			}
			obj.isActive = true;
			var videoList = obj.videoList;
			var children = obj.children;
			var src = "img/floorImage/" + obj.id + ".png";
			setTimeout(function() {
				$("#floorImage").zoomMarker_LoadImage(src);
				$("#floorImage").zoomMarker_CleanMarker();
				for(var i = 0; i < videoList.length; i++) {
					var src = children[i].src;
					var x = children[i].x;
					var y = children[i].y;
					var deviceVideoId = "videoPlayer" + i;
					var streamAddress = videoList[i].streamAddress;
					var dom = "<div class='floor-video-box'><div class='video-circle-box position-right'></div><div class='video-box position-left'><video id='" + deviceVideoId + "' class='video-js vjs-default-skin vjs-big-play-centered' controls preload='auto' autoplay='autoplay'><source src='" + videoUrl + "' type='rtmp/flv' /></video><div class='decorate-list decorate-left-top position-left-top'></div><div class='decorate-list decorate-left-bottom position-left-bottom'></div><div class='decorate-list decorate-right-top position-right-top'></div><div class='decorate-list decorate-right-bottom position-right-bottom'></div></div></div>"
					$('#floorImage').zoomMarker_AddMarker({
						src: src,
						x: x,
						y: y,
						deviceVideoId: deviceVideoId,
						streamAddress: streamAddress,
						hint: {
							value: dom
						},
						click: function(e) {
							showVideo(e);
						}
					});
				}
			}, 1000);
		}

		//格式化视频控件
		function resetVideo() {
			var videoBox = $(".video-box");
			for(var i = 0; i < videoBox.length; i++) {
				var deviceVideoId = videoBox.eq(i).find(".video-js").attr("id");
				disposeVideo(deviceVideoId);
			}
		}

		//显示视频控件
		function showVideo(e) {
			var param = e.param;
			var marker = e.marker;
			var size = e.param.size;
			marker.find(".floor-video-box").css({
				"top": param.size / 2,
				"left": param.size
			}).show(500);
			playerVideo(param.deviceVideoId, param.streamAddress);
		}

		//设置水波球
		function setWaveProgress(id, dataInfo) {
			var waterValue = dataInfo.waterValue ? dataInfo.waterValue : 0;
			var referMinValue = dataInfo.referMinValue;
			var referMaxValue = dataInfo.referMaxValue;
			var endValue = waterValue / referMaxValue * 100;
			if(waterValue < referMinValue || waterValue > referMaxValue) {
				var afterColor = ["rgba(175, 21, 21, 0.3)", "rgba(253, 60, 60, 0.3)"];
				var frontColor = ["rgba(175, 21, 21, 0.9)", "rgba(253, 60, 60, 0.9)"];
			} else {
				var afterColor = ["rgba(51, 217, 251, 0.3)", "rgba(7, 166, 255, 0.3)"];
				var frontColor = ["rgba(51, 217, 251, 0.9)", "rgba(7, 166, 255, 0.9)"];
			}
			waveProgress({
				id: id,
				endValue: endValue,
				fillText: waterValue,
				afterColor: afterColor,
				frontColor: frontColor,
				fontSize: suitRem(0.22),
			});
		}

		//消防供水
		function getFireWater() {
			var param = {};
			request("POST", "/home/v1/findWaterSupplyData", param, true, function(res) {
				var dataList = res.data.dataList;
				setData.fireWater = dataList;
				nextTick(function() {
					var fireWater = new Swiper('.fire-water-swiper', {
						direction: 'horizontal',
						loop: true,
						autoplay: {
							delay: 5000,
							stopOnLastSlide: false,
							disableOnInteraction: true,
						},
						pagination: {
							el: '.fire-water-swiper .swiper-pagination',
							clickable: true
						}
					})
					var dom = $(".fire-water-box .swiper-slide");
					for(var i = 0; i < dom.length; i++) {
						var id = "waveProgress" + i;
						dom.eq(i).find("canvas").attr("id", id);
						var index = dom.eq(i).attr("data-swiper-slide-index");
						setWaveProgress(id, dataList[index]);
					}
				})
			}, function(res) {
				top.layer.msg("消防供水加载失败");
			});
		}

		//电气火灾
		function getElectricFire() {
			var param = {};
			request("POST", "/home/v1/findElectricFireData", param, true, function(res) {
				setData.electricFire = res.data.dataList;
				nextTick(function() {
					var electricFire = new Swiper('.electric-fire-swiper', {
						direction: 'horizontal',
						loop: true,
						autoplay: {
							delay: 5000,
							stopOnLastSlide: false,
							disableOnInteraction: true,
						},
						pagination: {
							el: '.electric-fire-swiper .swiper-pagination',
							clickable: true
						}
					})
				})
			}, function(res) {
				top.layer.msg("电气火灾加载失败");
			})
		}

		//月度汇总
		function getMonthSummary() {
			var month = resetTime(year + "-" + $("#monthSummary").val(), 4);
			var param = {
				month: month
			}
			request("POST", "/home/v1/monthSummary", param, true, function(res) {
				setData.monthSummary = res.data;
			}, function(res) {
				top.layer.msg("月度汇总获取失败");
			});
		}

		//安全指数
		function getSafetyLevel() {
			var param = {};
			request("POST", "/home/v1/safetyLevel", param, true, function(res) {
				var dataInfo = res.data;
				dataInfo.rankingNum = formatZero(dataInfo.rankingNum, 2);
				setData.safetyLevel = dataInfo;
				setCircleProgress($(".security-index-pie"), dataInfo.scoreNum, suitRem(0.03), ["#2aa1e4", "#35c6ef"]);
			}, function(res) {
				top.layer.msg("安全指数获取失败");
			})
		}

		//设置重点压力罗盘
		function setKeyStress(myChart, min, max, value) {
			var radius = $(".key-stress-gauge-box").width() / 2;
			if(value < min || value > max) {
				var detailColor = "#fd0101";
			} else {
				var detailColor = "#07a6ff";
			}
			myChart.setOption({
				series: [{
					name: '重点压力',
					type: 'gauge',
					center: ['50%', "60%"],
					min: 0,
					max: 1,
					splitNumber: 5,
					radius: radius,
					startAngle: 180,
					endAngle: 0,
					detail: {
						show: true,
						textStyle: {
							fontWeight: 'bolder',
							fontSize: suitRem(0.22),
							color: detailColor
						}
					},
					axisLine: {
						lineStyle: {
							width: suitRem(0.05),
							color: [
								[0.2, '#07a6ff'],
								[0.8, '#27f3fa'],
								[1, '#07a6ff']
							]
						}
					},
					axisTick: {
						splitNumber: 10,
						length: 10,
						lineStyle: {
							color: 'auto'
						}
					},
					splitLine: {
						length: 10,
						lineStyle: {
							color: 'auto',
							width: 2,
						}
					},
					pointer: {
						width: suitRem(0.04),
						length: "70%"
					},
					title: {
						textStyle: {
							fontWeight: "bolder",
							fontSize: suitRem(0.14),
							color: '#07a6ff'
						}
					},
					data: [{
						value: value,
						name: 'Mpa'
					}]
				}]
			}, true);
		}

		//加载重点压力
		function getGravityPressureData() {
			var param = {
				pageNo: pageNo,
				pageSize: "1000"
			};
			request("POST", "/home/v1/findGravityPressureData", param, true, function(res) {
				var dataList = res.data.dataList;
				setData.keyStress = dataList;
				nextTick(function() {
					var keyStress = new Swiper('.key-stress-swiper', {
						direction: 'horizontal',
						loop: true,
						slidesPerView: 2,
						slidesPerGroup: 2,
						autoplay: {
							delay: 5000,
							stopOnLastSlide: false,
							disableOnInteraction: true,
						},
						pagination: {
							el: '.key-stress-swiper .swiper-pagination',
							clickable: true
						}
					})
					var dom = $(".key-stress-box .swiper-slide");
					for(var i = 0; i < dom.length; i++) {
						var index = dom.eq(i).attr("data-swiper-slide-index");
						var myChart = window['keyStressGauge' + i] = echarts.init(dom.eq(i).find(".key-stress-gauge-box").get(0));
						var pressureValue = parseFloat(dataList[index].pressureValue / 1000);
						setKeyStress(myChart, dataList[index].lowestValue, dataList[index].highestValue, pressureValue);
					}
				})
			}, function(res) {
				top.layer.msg("重点压力加载失败");
			})
		}

		//车流量
		function getCarAccess() {
			var dateArray = getAppointDate(7, 0);
			var totalCar = ["30", "50", "20", "25", "30", "22", "8"];
			var inPark = ["40", "30", "10", "10", "15", "6", "0"];
			var outPark = ["10", "10", "40", "5", "10", "14", "14"];
			carAccess.setOption({
				tooltip: {
					trigger: 'axis',
					axisPointer: {
						type: 'cross'
					}
				},
				legend: {
					bottom: '6',
					itemWidth: suitRem(0.08),
					itemHeight: suitRem(0.08),
					itemGap: suitRem(0.2),
					data: ['场内车辆总数', '入场车辆数', '出场车辆数'],
					textStyle: {
						color: "#fff",
						fontSize: suitRem(0.14),
						lineHeight: suitRem(0.14)
					}
				},
				grid: {
					left: suitRem(0.4),
					right: suitRem(0.4),
					top: suitRem(0.4),
					bottom: suitRem(0.5)
				},
				xAxis: [{
					type: 'category',
					data: dateArray,
					axisLabel: {
						interval: 0,
						textStyle: {
							color: "#fff"
						}
					},
					splitLine: {
						show: false
					},
					axisLine: {
						show: true,
						lineStyle: {
							color: ["rgba(30, 149, 255, 0.8)"]
						}
					},
					axisTick: {
						show: false
					}
				}],
				yAxis: [{
					name: "车数量(辆)",
					nameTextStyle: {
						color: "#fff",
						fontSize: suitRem(0.14)
					},
					type: 'value',
					axisLabel: {
						interval: 0,
						textStyle: {
							color: "#fff"
						}
					},
					splitLine: {
						show: true,
						lineStyle: {
							type: "dashed",
							color: ['rgba(13, 66, 133, 0.6)']
						}
					},
					axisLine: {
						show: true,
						lineStyle: {
							color: ["rgba(30, 149, 255, 0.8)"]
						}
					},
					axisTick: {
						show: false
					}
				}],
				series: [{
					name: '场内车辆总数',
					type: 'bar',
					barWidth: suitRem(0.1),
					itemStyle: {
						normal: {
							color: {
								type: 'linear',
								x: 0,
								y: 0,
								x2: 0,
								y2: 1,
								colorStops: [{
									offset: 0,
									color: '#1bfde4'
								}, {
									offset: 1,
									color: '#41a0f2'
								}]
							}
						}
					},
					data: totalCar
				}, {
					name: '入场车辆数',
					type: 'line',
					symbol: "circle",
					symbolSize: suitRem(0.05),
					hoverAnimation: true,
					itemStyle: {
						normal: {
							color: '#fe0202'
						}
					},
					lineStyle: {
						normal: {
							color: '#fe0202',
							width: suitRem(0.01)
						}
					},
					data: inPark
				}, {
					name: '出场车辆数',
					type: 'line',
					symbol: "circle",
					symbolSize: suitRem(0.05),
					hoverAnimation: true,
					itemStyle: {
						normal: {
							color: '#ffc703'
						}
					},
					lineStyle: {
						normal: {
							color: '#ffc703',
							width: suitRem(0.01)
						}
					},
					data: outPark
				}]
			}, true);
		}

		//访客
		function getVisitorAccess() {
			totalNumber = ["6", "164", "532", "258", "80", "2"];
			visitorAccess.setOption({
				tooltip: {
					trigger: 'axis',
					axisPointer: {
						type: 'cross'
					}
				},
				grid: {
					left: "90",
					right: "10",
					bottom: "10",
					top: "10"
				},
				xAxis: [{
					type: 'value',
					show: false
				}],
				yAxis: [{
					type: 'category',
					show: true,
					data: ["20:00-24:00", "16:00-20:00", "12:00-16:00", "08:00-12:00", "04:00-08:00", "00:00-04:00"],
					axisLabel: {
						interval: 0,
						textStyle: {
							color: "#fff"
						}
					},
					axisLine: {
						show: false
					},
					axisTick: {
						show: false
					}
				}],
				series: [{
					name: '已完成',
					type: 'bar',
					barWidth: suitRem(0.1),
					stack: '总量',
					hoverAnimation: true,
					label: {
						normal: {
							show: true,
							position: 'right',
							textStyle: {
								color: "#fff"
							}
						}
					},
					itemStyle: {
						normal: {
							color: {
								type: 'linear',
								x: 0,
								y: 0,
								x2: 0,
								y2: 1,
								colorStops: [{
									offset: 0,
									color: '#07a6ff'
								}, {
									offset: 1,
									color: '#33d9fb'
								}]
							}
						}
					},
					data: totalNumber
				}]
			}, true);
		}

		//加载工单
		function getWorkOrder(showLoading) {
			var param = {
				state: "0"
			}
			request("POST", "/workOrder/queryList.do", param, showLoading, function(res) {
				var dataList = res.data.dataList;
				if(dataList.length > 3) {
					dataList.push(dataList[0]);
				}
				setData.workOrderList = dataList;
				nextTick(function() {
					seamlessRolling("workOrder", 5000);
				});
			}, function(res) {
				top.layer.msg("工单记录加载失败");
			});
		}

		loadFloorImage();
		getTodayAlarm();
		setDeviceType(true);
		getCheckTask();
		loadRegion();
		getFireWater();
		getElectricFire();
		getMonthSummary();
		getSafetyLevel();
		getGravityPressureData();
		getWorkOrder(true);
		bindWindowChange(function() {
			var safetyLevel = setData.safetyLevel;
			var checkTask = setData.checkTask;
			checkTaskBar.resize();
			var dom = $(".key-stress-box .swiper-slide");
			for(var i = 0; i < dom.length; i++) {
				window['keyStressGauge' + i].resize();
			}
			setCircleProgress($(".security-index-pie"), safetyLevel.scoreNum, suitRem(0.03), ["#2aa1e4", "#35c6ef"]);
			setCircleProgress($(".check-task-pie"), checkTask.completeRate, suitRem(0.08), ["#2aa1e4", "#35c6ef"]);
		})

		timeTask(60000, function() {
			getWorkOrder(false);
			setDeviceType(false);
		})
	</script>

</html>